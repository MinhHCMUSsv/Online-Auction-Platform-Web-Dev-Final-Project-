<!-- Breadcrumb -->
<div class="bg-white border-bottom">
    <div class="container-fluid px-4 py-2 small text-muted">
        Menu / Category1 / {{product.name}}
    </div>
</div>

<main class="container-fluid px-4 py-4">
    <!-- Back button -->
    <div class="mb-3">
        <button class="btn btn-light back-btn">
            <i class="bi bi-arrow-left"></i> Back
        </button>
    </div>

    <!-- Main product section -->
    <div class="row g-4">
        <!-- Left: big image + thumbnails -->
        <div class="col-lg-6">
            <div class="position-relative mb-3">
                <div class="product-main-img d-flex justify-content-center align-items-center">
                    Image
                </div>

                <!-- Image arrows -->
                <button class="btn btn-light rounded-circle position-absolute top-50 start-0 translate-middle-y ms-3">
                    <i class="bi bi-chevron-left"></i>
                </button>
                <button class="btn btn-light rounded-circle position-absolute top-50 end-0 translate-middle-y me-3">
                    <i class="bi bi-chevron-right"></i>
                </button>
            </div>

            <!-- Color / image swatches -->
            <div class="d-flex gap-3">
                <div class="thumb-swatch"></div>
                <div class="thumb-swatch bg-dark"></div>
                <div class="thumb-swatch" style="background:#707780;"></div>
                <div class="thumb-swatch" style="background:#d2d6dd;"></div>
            </div>
        </div>

        <!-- Right: info -->
        <div class="col-lg-6">
            <div class="product-card h-100">
                <h3 class="mb-3">{{product.name}}</h3>

                <!-- Seller -->
                <div class="d-flex align-items-center mb-3">
                    <div class="badge-avatar badge-avatar-orange me-3">
                        S
                    </div>
                    <div>
                        <div class="fw-semibold">Seller: {{seller.seller_name}}</div>
                        <small class="text-muted">Points: {{seller.seller_point}}</small> 
                    </div>
                </div>

                <div class="mb-2 fw-semibold">
                    Highest bid: <span class="text-warning">${{bidder.[0].max_auto_bid}}</span>
                </div>

                <!-- Highest bidder -->
                <div class="d-flex align-items-center mb-3">
                    <div class="badge-avatar badge-avatar-dark me-3">
                        B
                    </div>
                    <div>
                        <div class="fw-semibold">{{bidder.[0].full_name}}</div>
                        <small class="text-muted">Points: {{bidder.[0].points}}</small>
                    </div>
                </div>

                <ul class="list-unstyled small text-muted mb-3">
                    <li>Listed: 02/11/2025</li>
                    <li>Time left: 11/11/2025</li>
                    <li>Bids: 10</li>
                </ul>

                <div class="fw-semibold mb-3">
                    Buy it now: <span class="text-primary">$100</span>
                </div>

                <div class="d-flex gap-2">
                    <button class="btn btn-primary px-4">
                        Place bid
                    </button>
                    <button class="btn btn-outline-secondary px-4">
                        <i class="bi bi-heart"></i> Watch
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bidding section (only show when logged in) -->
    {{#if isAuthenticated}}
    <section class="mt-5">
        <div class="row g-4">
            <!-- Bid Form -->
            <div class="col-lg-6">
                <div class="card border-primary">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">Place Your Bid</h5>
                    </div>
                    <div class="card-body">
                        <form method="POST" action="/products/place-bid">
                            <div class="mb-3">
                                <label for="bidAmount" class="form-label">Bid Amount</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" 
                                           class="form-control" 
                                           id="bidAmount" 
                                           name="max_auto_bid" 
                                           placeholder="Enter your bid amount"
                                           min="{{product.start_price}}"
                                           required>

                                    <input type="hidden" name="product_id" value="{{product.product_id}}">
                                    <input type="hidden" name="bidder_id" value="{{authUser.user_id}}">
                                    
                                    
                                </div>
                            </div>
                            
                            Minimum bid: ${{product.start_price}}<br>

                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn-primary px-4">
                                    <i class="bi bi-hammer"></i> Submit Bid
                                </button>
                                <button type="reset" class="btn btn-outline-secondary px-4">
                                    Clear
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Bidding History -->
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">
                            <i class="bi bi-list-ul"></i> Bidding History
                        </h5>
                    </div>
                    <div class="card-body" style="max-height: 500px; overflow-y: auto;">
                        {{#if bidder}}
                            <div class="table-responsive">
                                <table class="table table-sm table-hover mb-0">
                                    <thead>
                                        <tr class="table-light">
                                            <th>Bidder</th>
                                            <th class="text-end">Bid Amount</th>
                                            <th class="text-end">Max Auto Bid</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {{#each bidder}}
                                        <tr {{#if @first}}class="table-warning fw-semibold"{{/if}}>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <div class="badge {{#if @first}}bg-warning text-dark{{else}}bg-secondary{{/if}} rounded-circle me-2" style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;">
                                                        {{#if this.full_name}}
                                                            {{substr this.full_name 0 1}}
                                                        {{else}}
                                                            ?
                                                        {{/if}}
                                                    </div>
                                                    <div>
                                                        <span class="fw-semibold">{{this.full_name}}</span>
                                                        {{#if @first}}<span class="badge bg-warning text-dark ms-2">ðŸ‘‘ Leading</span>{{/if}}
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="text-end">
                                                <span class="badge {{#if @first}}bg-warning text-dark{{else}}bg-warning text-dark{{/if}}">${{this.bid_amount}}</span>
                                            </td>
                                            <td class="text-end">
                                                <span class="text-muted small">${{this.max_auto_bid}}</span>
                                            </td>
                                        </tr>
                                        {{/each}}
                                    </tbody>
                                </table>
                            </div>
                        {{else}}
                            <p class="text-muted text-center py-4">
                                <i class="bi bi-inbox"></i><br>
                                No bids yet. Be the first to bid!
                            </p>
                        {{/if}}
                    </div>
                </div>
            </div>
        </div>
    </section>
    {{else}}
    <section class="mt-5">
        <div class="alert alert-info d-flex align-items-center" role="alert">
            <i class="bi bi-info-circle me-3" style="font-size: 1.5rem;"></i>
            <div>
                <strong>Want to place a bid?</strong> 
                <a href="/account/signin" class="alert-link">Sign in</a> or 
                <a href="/account/signup" class="alert-link">create an account</a> to start bidding!
            </div>
        </div>
    </section>
    {{/if}}

    <!-- Description section -->
    <section class="mt-5">
        <h5 class="mb-3">Description</h5>

        <div>{{{product.description_html}}}</div>
    </section>

    <!-- Feedback section -->
    <section class="mt-5">
        <h5 class="mb-3">Feedback</h5>
        {{#each comments}}
            <!-- Main comment -->
            <div class="section-box d-flex mb-2">
                <div class="me-3">
                    <div class="feedback-avatar {{#if (eq this.role 0)}}feedback-avatar-gray{{/if}}">
                        {{this.reviewer_initials}}
                    </div>
                </div>
                <div class="flex-grow-1">
                    <div class="fw-semibold mb-1">{{this.reviewer_name}}</div>
                    <p class="small mb-0 text-muted">
                        {{this.content}}
                    </p>
                </div>
            </div> 

            <!-- Replies (nested comments) -->
            {{#each this.replies}}
            <div class="section-box d-flex mb-2 ms-5 border-start border-3 border-secondary ps-3">
                <div class="me-3">
                    <div class="feedback-avatar {{#if (eq this.role 1)}}feedback-avatar-gray{{/if}}">
                        {{this.reviewer_initials}}
                    </div>
                </div>
                <div class="flex-grow-1">
                    <div class="fw-semibold mb-1">{{this.name}}</div>
                    <p class="small mb-0 text-muted">
                        {{this.content}}
                    </p>
                </div>
            </div>
            {{/each}}

            <div class="mb-3"></div>
        {{/each}}
    </section>

    <!-- Related products -->
    <section class="mt-5 mb-5">
        <h5 class="mb-3">Related products</h5>
        <div class="row g-3">
            <!-- Repeat this col for more products -->

            {{#each related_products}}
            <div class="col-6 col-md-4 col-lg-2">
                <div class="related-card">
                    <div class="related-img d-flex align-items-center justify-content-center">
                        Image
                    </div>

                    <button class="wishlist-btn">
                        <i class="bi bi-heart"></i>
                    </button>

                    <div class="p-2 small">
                        <div class="fw-semibold">{{this.name}}</div>
                        <div>Name of the bidder</div>
                        <div class="fw-semibold mb-1">$90</div>

                        <div class="text-muted">
                            <div>Buy it now: <span class="text-primary">$100</span></div>
                            <div>Listed: 02/11/2025</div>
                            <div>Time left: 11/11/2025</div>
                            <div>Bids: 9</div>
                        </div>
                    </div>
                </div>
            </div>
            {{/each}}

        </div>
    </section>
</main>