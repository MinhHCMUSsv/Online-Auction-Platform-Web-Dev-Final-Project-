{{#section 'css'}}
<style>
  /* Style Header Bảng */
  .table thead th {
    border-bottom: 2px solid #000;
    /* Đường kẻ đậm màu đen */
    font-weight: 700;
    font-size: 1rem;
    padding-bottom: 10px;
  }

  /* Style Hàng (Đường kẻ đứt) */
  .dashed-line {
    border-bottom: 1px dashed #ccc;
  }

  .table tbody td {
    vertical-align: middle;
    padding: 15px 5px;
    font-weight: 500;
  }

  /* Status Text */
  .status-waiting {
    color: #495057;
  }

  /* Nút Pay */
  .btn-pay {
    border: 2px solid #FF8C00;
    color: #FF8C00;
    background: transparent;
    font-weight: 700;
    padding: 4px 20px;
    border-radius: 4px;
    text-decoration: none;
    transition: 0.2s;
  }

  .btn-pay:hover {
    background-color: #FF8C00;
    color: white;
  }

  /* Icon Success */
  .icon-success {
    color: #198754;
    /* Màu xanh lá */
    font-size: 1.5rem;
  }

  .price-text {
    font-weight: 800;
    font-size: 1.1rem;
  }

  .clickable-row {
    cursor: pointer; 
    transition: background-color 0.2s;
  }
  .clickable-row:hover {
    background-color: #f8f9fa; 
  }
</style>
{{/section}}

<h3 class="mb-4 fw-bold" style="color: #FF8C00;">Won items</h3>

{{#if empty}}
<div class="alert alert-info text-center py-4">
  You haven't won any auctions yet. <br>
  <a href="/menu" class="alert-link">Keep bidding!</a>
</div>
{{else}}

<div class="table-responsive">
  <table class="table table-borderless">
    <thead>
      <tr>
        <th scope="col">Auction id</th>
        <th scope="col">Date</th>
        <th scope="col">Status</th>
        <th scope="col">Total</th>
        <th scope="col" class="text-end pe-3">Note</th>
      </tr>
    </thead>
    <tbody>
      {{#each wonItems}}
      <tr class="dashed-line clickable-row" data-href="/menu/detail?product_id={{this.product_id}}">

        <td class="fw-bold">#{{this.product_id}}</td>

        <td>{{formatDate this.end_time "DD/MM/YYYY"}}</td>

        <td>
          <span class="{{#unless this.is_paid}}status-waiting{{/unless}}">
            {{this.status_text}}
          </span>
        </td>

        <td class="price-text">{{formatCurrency this.current_price}}</td>

        <td class="text-end pe-3">
          {{#if (eq this.transaction_status 2)}}
            {{!-- Trạng thái 2: Success -> Hiện cả Icon Check VÀ Nút Rate --}}
            <div class="d-flex align-items-center justify-content-end gap-2">
                <i class="bi bi-check-circle-fill icon-success" title="Success"></i>
                
                {{#if this.can_rate}}
                <a href="/profile/rating?product_id={{this.product_id}}&id={{this.transaction_id}}" 
                    class="btn btn-sm btn-warning fw-bold text-dark">
                    <i class="bi bi-star-fill"></i> Rate
                </a>
                {{/if}}
            </div>
          
          {{else if (eq this.transaction_status 0)}}
            {{!-- Trạng thái 0: Cancelled --}}
            <i class="bi bi-x-circle-fill text-danger" title="Cancelled"></i>
          
          {{else}}
            {{!-- Các trạng thái còn lại: Hiện nút Pay --}}
            <a href="/transaction?product_id={{this.product_id}}" class="btn-pay">Pay</a>
          {{/if}}
        </td>

      </tr>
      {{/each}}
    </tbody>
  </table>
</div>
{{/if}}

{{#section 'js'}}
<script>
  $(document).ready(function($) {
    $(".clickable-row").click(function() {
      window.location = $(this).data("href");
    });

    $(".btn-pay, .btn-warning, a.btn").click(function(e) {
      e.stopPropagation(); 
    });
  });
</script>
{{/section}}