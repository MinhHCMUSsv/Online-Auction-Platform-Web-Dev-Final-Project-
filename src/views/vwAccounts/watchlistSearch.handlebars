{{#section 'js'}}
<script>
    $('.wishlist-icon').on('click', function (e) {
        e.preventDefault();
        const $btn = $(this);
        const productId = $btn.data('id');
        const $cardColumn = $btn.closest('.watchlist-item');

        $.post('/menu/watchlist/toggle', { product_id: productId }, function (data) {
            if (data.success) {
                if (data.isAdded === false) {
                    $cardColumn.fadeOut(300, function () {
                        $(this).remove();
                        if ($('.product-card').length === 0) {
                            location.reload();
                        }
                    });
                }
            } else {
                alert('Something went wrong');
            }
        }).fail(function () {
            alert('Cannot connect to server!');
        });
    });
</script>
{{/section}}

{{#section 'css'}}
<style>
    .product-card {
        transition: transform 0.2s;
    }

    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .text-gold {
        color: #ffc107 !important;
    }

    .wishlist-icon:hover {
        transform: scale(1.2);
        transition: 0.2s;
    }

    .product-image-placeholder {
        height: 220px;
        overflow: hidden;
        background-color: #f8f9fa;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .product-image-placeholder img {
        object-fit: contain;
        width: 100%;
        height: 100%;
    }

    /* Style cho thanh tìm kiếm */
    .search-form .form-control {
        border-radius: 50px 0 0 50px;
        border-right: none;
    }

    .search-form .btn {
        border-radius: 0 50px 50px 0;
        border-left: none;
        background-color: white;
        border-color: #ced4da;
    }

    .search-form .btn:hover {
        background-color: #f8f9fa;
    }
</style>
{{/section}}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="fw-bold text-primary mb-0">Search Results</h3>

    <form action="/profile/watchlist/search" method="GET" class="d-flex search-form" style="width: 300px;">
        <input class="form-control" type="search" name="q" placeholder="Search in watchlist..." value="{{query}}"
            required>
        <button class="btn" type="submit">
            <i class="bi bi-search text-muted"></i>
        </button>
    </form>
</div>

<div class="mb-3">
    <a href="/profile/watchlist" class="text-decoration-none"><i class="bi bi-arrow-left"></i> Back to full
        watchlist</a>
</div>

{{#if watchlist.length}}
<div class="row g-3">
    {{#each watchlist}}
    <div class="col-sm-6 col-md-4 watchlist-item">
        <div class="product-card h-100 border rounded bg-white position-relative">

            <button class="wishlist-icon border-0 position-absolute top-0 end-0 m-2 bg-transparent active"
                data-id="{{this.product_id}}">
                <i class="bi bi-heart-fill text-gold fs-5"></i>
            </button>

            <div class="product-image-placeholder bg-light d-flex align-items-center justify-content-center text-muted"
                style="height: 180px;">
                <img src="/src/static/images/{{seller_id}}/{{product_id}}/main_thumbs.jpg" class="img-fluid">
            </div>

            <div class="product-body p-3">
                <div class="d-flex justify-content-between align-items-start">
                    <h5 class="product-title mb-1 text-truncate" title="{{this.name}}">
                        {{this.name}}
                    </h5>
                </div>

                <p class="mb-1 small">
                    <span>{{#if this.current_bidder_name}}Highest Bidder: {{this.current_bidder_name}}{{else}}No
                        Bids{{/if}}</span><br>
                </p>

                <p class="product-meta mb-1 small text-muted">
                    <span class="fw-bold text-primary fs-5">
                        {{#if this.current_price}}
                        {{formatCurrency this.current_price}}
                        {{else}}
                        {{formatCurrency this.start_price}}
                        {{/if}}
                    </span>
                    <br>
                    <span>Buy it now: <span class="fw-bold text-primary">{{#if this.buy_now_price}}{{formatCurrency
                            this.buy_now_price}}{{else}} None {{/if}}</span></span><br>
                    <span>Listed: {{formatDate this.created_at "DD/MM/YYYY HH:mm"}}</span><br>
                    <span>Time left: {{formatAuctionTime this.end_time "DD/MM/YYYY HH:mm"}}</span><br>
                    <span>Bids: {{this.bid_count}}</span>
                </p>

                <div class="mt-2">
                    <a href="/menu/detail?product_id={{this.product_id}}"
                        class="btn btn-sm btn-outline-primary w-100">Details</a>
                </div>
            </div>

        </div>
    </div>
    {{/each}}
</div>

{{else}}
<div class="alert alert-warning text-center">
    <i class="bi bi-search display-6 d-block mb-3"></i>
    No products found in your watchlist matching <strong>"{{query}}"</strong>.
    <br>
    <a href="/profile/watchlist" class="btn btn-outline-dark mt-3">View All Watchlist</a>
</div>
{{/if}}